<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Snova Web MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!--
    üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ GitHub Pages:
    1. –ó–∞–∫–∏–Ω—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –∫–æ—Ä–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∫–∞–∫ index.html.
    2. –ó–∞–π–¥–∏ –≤ Settings ‚Üí Pages.
    3. –í Source –≤—ã–±–µ—Ä–∏ Branch = main (–∏–ª–∏ master), Folder = /(root).
    4. –ß–µ—Ä–µ–∑ 1‚Äì2 –º–∏–Ω—É—Ç—ã –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ:
       https://USERNAME.github.io/REPO-NAME/
  -->

  <!-- –î–ª—è GitHub Pages: —Ä–∞–∑—Ä–µ—à–∞–µ–º inline-—Å—Ç–∏–ª–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">

  <style>
    body { font-family: system-ui, -apple-system, Arial, sans-serif; margin: 0; padding: 16px; background: #f7f7fb; color: #111; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .card { background: #fff; border-radius: 12px; padding: 12px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    textarea, input, button { font: inherit; }
    textarea { width: 100%; min-height: 140px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    button { padding: 8px 12px; border-radius: 8px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
    button.primary { background: #2f6fff; color: #fff; border-color: #2f6fff; }
    .dream-view { line-height: 1.6; background: #fafafa; padding: 10px; border-radius: 8px; border: 1px dashed #ddd; min-height: 100px; white-space: pre-wrap; }
    mark[data-block] { background: #ffe9a8; padding: 0 2px; border-radius: 3px; cursor: pointer; }
    .blocks { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
    .chip { padding: 6px 10px; border-radius: 999px; background: #eef2ff; color: #2f3a8f; cursor: pointer; border: 1px solid transparent; }
    .chip.active { background: #2f6fff; color: #fff; }
    .chat { display: flex; flex-direction: column; gap: 8px; height: 360px; overflow: auto; border: 1px solid #eee; padding: 10px; border-radius: 8px; background: #fcfcff; }
    .msg { max-width: 80%; padding: 8px 10px; border-radius: 10px; }
    .bot { background: #eef2ff; align-self: flex-start; }
    .user { background: #eafbea; align-self: flex-end; }
    .quick { display: flex; gap: 8px; margin-top: 6px; }
    .muted { color: #666; font-size: 12px; }
    .footer { margin-top: 12px; display: flex; gap: 8px; }
  </style>
</head>
<body>
  <h1>Snova ‚Äî –≤–µ–±-MVP (–±–µ–∑ —Ö—Ä–∞–Ω–µ–Ω–∏—è)</h1>
  <p><a href="https://github.com/USERNAME/REPO-NAME" target="_blank">–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub</a></p>

  <div class="row">
    <div class="card">
      <h3>1) –í–≤–µ–¥–∏—Ç–µ —Å–æ–Ω</h3>
      <textarea id="dream" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å–Ω–∞..."></textarea>
      <div class="controls">
        <button id="render">–ü–æ–∫–∞–∑–∞—Ç—å –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è</button>
        <button id="auto">–ê–≤—Ç–æ–±–ª–æ–∫–∏ (—á–µ—Ä–µ–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)</button>
        <button id="clear">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
        <button id="export">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
        <input type="file" id="import" accept="application/json" />
      </div>
      <p class="muted">–í—ã–¥–µ–ª–∏—Ç–µ –º—ã—à–∫–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –Ω–∏–∂–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ‚Äú–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫‚Äù.</p>
      <div class="dream-view" id="dreamView"></div>
      <div class="controls">
        <button id="addBlock">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –ø–æ –≤—ã–¥–µ–ª–µ–Ω–∏—é</button>
      </div>
      <div class="blocks" id="blocks"></div>
    </div>

    <div class="card">
      <h3>2) –î–∏–∞–ª–æ–≥ –ø–æ –±–ª–æ–∫—É</h3>
      <div id="currentBlock" class="muted">–ë–ª–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
      <div class="chat" id="chat"></div>
      <div class="footer">
        <button class="primary" id="start">–ù–∞—á–∞—Ç—å/–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button id="finish">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>
        <button id="resetChat">–°–±—Ä–æ—Å–∏—Ç—å —á–∞—Ç</button>
      </div>
    </div>
  </div>

<script>
const dreamInput = document.getElementById('dream');
const dreamView = document.getElementById('dreamView');
const renderBtn = document.getElementById('render');
const autoBtn = document.getElementById('auto');
const clearBtn = document.getElementById('clear');
const exportBtn = document.getElementById('export');
const importInput = document.getElementById('import');
const addBlockBtn = document.getElementById('addBlock');
const blocksContainer = document.getElementById('blocks');
const currentBlockLabel = document.getElementById('currentBlock');
const chatContainer = document.getElementById('chat');
const startBtn = document.getElementById('start');
const finishBtn = document.getElementById('finish');
const resetChatBtn = document.getElementById('resetChat');

let blocks = [];
let currentBlockIndex = null;

function renderDreamView() {
  dreamView.innerHTML = dreamInput.value;
}

function autoSplitBlocks() {
  const sentences = dreamInput.value.split(/(?<=[.!?])\s+/);
  blocks = sentences.map((s, i) => ({ id: i + 1, text: s, chat: [] }));
  renderBlocks();
}

function clearAll() {
  dreamInput.value = '';
  dreamView.innerHTML = '';
  blocks = [];
  renderBlocks();
}

function exportJSON() {
  const data = JSON.stringify(blocks, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'dream.json';
  a.click();
}

function importJSON(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    blocks = JSON.parse(ev.target.result);
    renderBlocks();
  };
  reader.readAsText(file);
}

function addBlock() {
  const sel = window.getSelection();
  const text = sel.toString().trim();
  if (text) {
    blocks.push({ id: Date.now(), text, chat: [] });
    renderBlocks();
  }
}

function renderBlocks() {
  blocksContainer.innerHTML = '';
  blocks.forEach((b, idx) => {
    const chip = document.createElement('div');
    chip.className = 'chip' + (idx === currentBlockIndex ? ' active' : '');
    chip.textContent = b.text.length > 30 ? b.text.slice(0, 30) + '‚Ä¶' : b.text;
    chip.onclick = () => { currentBlockIndex = idx; renderBlocks(); renderChat(); };
    blocksContainer.appendChild(chip);
  });
}

function renderChat() {
  chatContainer.innerHTML = '';
  if (currentBlockIndex == null) {
    currentBlockLabel.textContent = '–ë–ª–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω';
    return;
  }
  currentBlockLabel.textContent = '–ë–ª–æ–∫: ' + blocks[currentBlockIndex].text;
  blocks[currentBlockIndex].chat.forEach(msg => {
    const div = document.createElement('div');
    div.className = 'msg ' + msg.role;
    div.textContent = msg.text;
    chatContainer.appendChild(div);
  });
}

renderBtn.onclick = renderDreamView;
autoBtn.onclick = autoSplitBlocks;
clearBtn.onclick = clearAll;
exportBtn.onclick = exportJSON;
importInput.onchange = importJSON;
addBlockBtn.onclick = addBlock;
resetChatBtn.onclick = () => {
  if (currentBlockIndex != null) {
    blocks[currentBlockIndex].chat = [];
    renderChat();
  }
};

startBtn.onclick = () => {
  if (currentBlockIndex != null) {
    blocks[currentBlockIndex].chat.push({ role: 'bot', text: 'AI: –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ...' });
    renderChat();
  }
};
finishBtn.onclick = () => {
  if (currentBlockIndex != null) {
    blocks[currentBlockIndex].chat.push({ role: 'bot', text: 'AI: –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω ‚úÖ' });
    renderChat();
  }
};
</script>
</body>
</html>
